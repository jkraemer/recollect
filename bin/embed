#!/usr/bin/env python3
"""Generate embeddings for Recollect memory server.

Reads JSON from stdin with format: {"texts": ["text1", "text2", ...]}
Outputs JSON to stdout: {"embeddings": [[0.1, ...], [...]], "dimensions": 384}

Uses the all-MiniLM-L6-v2 model (384 dimensions) from sentence-transformers.
"""
import sys
import json

from sentence_transformers import SentenceTransformer

MODEL_NAME = "sentence-transformers/all-MiniLM-L6-v2"
DIMENSIONS = 384


def main():
    model = SentenceTransformer(MODEL_NAME)

    input_data = json.load(sys.stdin)
    texts = input_data.get("texts", [])

    if not texts:
        json.dump({"embeddings": [], "dimensions": DIMENSIONS}, sys.stdout)
        return

    embeddings = model.encode(texts, normalize_embeddings=True)

    json.dump({
        "embeddings": [emb.tolist() for emb in embeddings],
        "dimensions": DIMENSIONS
    }, sys.stdout)


if __name__ == "__main__":
    main()
